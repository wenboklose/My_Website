<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bo Wen">
<meta name="dcterms.date" content="2024-02-07">
<meta name="description" content="New grid code is on its way!">

<title>Bo Wen’s Website - FERC Order No.&nbsp;901</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
<meta property="og:title" content="Bo Wen’s Website - FERC Order No.&nbsp;901">
<meta property="og:description" content="New grid code is on its way!">
<meta property="og:image" content="img/FERC901.webp">
<meta property="og:site-name" content="Bo Wen's Website">
<meta name="twitter:title" content="Bo Wen’s Website - FERC Order No.&nbsp;901">
<meta name="twitter:description" content="New grid code is on its way!">
<meta name="twitter:image" content="img/FERC901.webp">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Bo Wen’s Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ferc-order-no.-901" id="toc-ferc-order-no.-901" class="nav-link active" data-scroll-target="#ferc-order-no.-901">FERC Order No.&nbsp;901</a></li>
  <li><a href="#current-nerc-reliability-standards" id="toc-current-nerc-reliability-standards" class="nav-link" data-scroll-target="#current-nerc-reliability-standards">Current NERC Reliability Standards</a></li>
  <li><a href="#ibr-related-reliability-gaps" id="toc-ibr-related-reliability-gaps" class="nav-link" data-scroll-target="#ibr-related-reliability-gaps">IBR-related Reliability Gaps</a></li>
  <li><a href="#my-thoughts" id="toc-my-thoughts" class="nav-link" data-scroll-target="#my-thoughts">My Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">FERC Order No.&nbsp;901</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Model</div>
    <div class="quarto-category">IBR</div>
    <div class="quarto-category">Inverter</div>
    <div class="quarto-category">FERC</div>
    <div class="quarto-category">Positive Sequence</div>
    <div class="quarto-category">EMT</div>
    <div class="quarto-category">NERC</div>
    <div class="quarto-category">Reliability</div>
    <div class="quarto-category">Model Validation</div>
    <div class="quarto-category">Data Sharing</div>
  </div>
  </div>

<div>
  <div class="description">
    New grid code is on its way!
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://scholar.google.co.uk/citations?user=cZKe8UMAAAAJ&amp;hl=en">Bo Wen</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 7, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="ferc-order-no.-901" class="level2">
<h2 class="anchored" data-anchor-id="ferc-order-no.-901">FERC Order No.&nbsp;901</h2>
<p><a href="#fig-FERC901">Figure&nbsp;1</a> is my summary of the Federal Energy Regulatory Commission (<a href="https://www.ferc.gov/">FERC</a>) <a href="https://www.ferc.gov/media/e-1-rm22-12-000">Order No.&nbsp;901</a>. In October 2023, FERC issued <a href="https://www.ferc.gov/media/e-1-rm22-12-000">Order No.&nbsp;901</a> directing the North American Electric Reliability Corporation (<a href="https://www.nerc.com/Pages/default.aspx">NERC</a>), the Commission-certified Electric Reliability Organization (ERO), to develop new or modified Reliability Standards to specifically address reliability gaps associated with inverter-based resources (IBR) – including PV, wind generation, and battery energy storage.</p>
<div id="fig-FERC901" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/New North America Grid Code On Its Way.png" class="img-fluid figure-img" style="width:200.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: FERC Order No.&nbsp;901</figcaption>
</figure>
</div>
<p>From FERC’s perspective, “the currently effective Reliability Standards do not ensure that Bulk-Power System planners and operators have the necessary tools to plan for and reliably integrate IBRs into the Bulk-Power System”.</p>
<p>As shown in <a href="#fig-FERC901">Figure&nbsp;1</a>, FERC wants all the directed Reliability Standards effective and enforceable <strong>well in advance of 2030</strong> ensuring an orderly <strong>industry transition</strong> for complying with IBR directives in Order No.&nbsp;901 prior to 2030.</p>
<p>By <strong>November 4, 2024</strong>, NERC must submit new or modified Reliability Standards that establish IBR performance requirements for IBR frequency and voltage ride through, post-disturbance ramp rates, phase-locked loop synchronization, and other known causes of IBR tripping or momentary cessation. NERC must also submit Reliability Standards that require disturbance monitoring data sharing and post-event performance validation for registered IBRs.</p>
<p>By <strong>November 4, 2025</strong>, NERC must submit Reliability Standards addressing the interrelated directive concerning: (1) data sharing for registered IBRs, unregistered IBRs, and IBR-DERs in the aggregate; (2) data and model validation for registered IBRs.</p>
<p>By <strong>November 4, 2026</strong>, NERC must submit Reliability Standards addressing planning and operational studies for registered IBRs.</p>
</section>
<section id="current-nerc-reliability-standards" class="level2">
<h2 class="anchored" data-anchor-id="current-nerc-reliability-standards">Current NERC Reliability Standards</h2>
<p>As the designated ERO by <a href="https://www.ferc.gov/">FERC</a>, <a href="https://www.nerc.com/Pages/default.aspx">NERC</a> was formed and its standards became mandatory and enforceable in the US for the first time on June 18, 2007.</p>
<p>The current <a href="https://www.nerc.com/pa/Stand/Reliability%20Standards%20Complete%20Set/RSCompleteSet.pdf">Reliability Standards for the Bulk Electric Systems of North America</a> is a document with over 1800 pages. Covering the following topics:</p>
<ul>
<li>BAL: Resource and Demand Balancing</li>
<li>CIP: Critical Infrastructure Protection</li>
<li>COM: Communications</li>
<li>EOP: Emergency Preparedness and Operations</li>
<li>FAC: Facilities Design, Connections, and Maintenance</li>
<li>INT: Interchange Scheduling and Coordination</li>
<li>IRO: Interconnection Reliability Operations and Coordination</li>
<li>MOD: Modeling, Data, and Analysis</li>
<li>NUC: Nuclear</li>
<li>PER: Personnel Performance, Training, and Qualifications</li>
<li>PRC: Protection and Control</li>
<li>TOP: Transmission Operations</li>
<li>TPL: Transmission Planning</li>
<li>VAR: Voltage and Reactive</li>
</ul>
</section>
<section id="ibr-related-reliability-gaps" class="level2">
<h2 class="anchored" data-anchor-id="ibr-related-reliability-gaps">IBR-related Reliability Gaps</h2>
<ul>
<li>Data Sharing:
<ul>
<li>The currently effective Reliability Standards do not require data that accurately represents IBRs to be provided to planning coordinators, transmission planners, reliability coordinators, transmission operators, and balancing authorities. Examples of needed data may include location, capacity, telemetry, steady-state, dynamic, and short-circuit modeling information, control settings, ramp rates, equipment status, and disturbance analysis data.</li>
<li>Reliability Standard MOD-032-1 does not require generator owners to submit registered IBR-specific modeling data and parameters such as control setting for momentary cessation and ramp rates, which are necessary for modeling steady and dynamic registered IBR performance for purposes of planning the Bulk-Power System (BPS).</li>
<li>Reliability Standard TOP-003-5 does not require generator owners to submit registered IBR-specific modeling data and parameters to their transmission operators or balancing authorities.</li>
<li>Current effective Reliability Standards do not ensure that BPS planners and operators receive disturbance monitoring data regarding all generation resources capable of having a material impact on the reliable operation of the BPS, including registered IBR. Such data is needed to adequately assess disturbance events and the behavior of IBRs during those events. (<strong><em>Can IBR monitor the data and report?</em></strong>)</li>
<li>Current effective Reliability Standards do not require Bulk-Power-System planners and operators to receive modeling data and parameters regarding unregistered IBRs. BPS planners and operators do not currently have the data to accurately model the behavior of registered and unregistered IBRs, and IBR-DERs for steady-state, dynamic, and short-circuit studies.</li>
</ul></li>
<li>Data and Model Validation
<ul>
<li>The currently effective Reliability Standards do not require the use of NERC’s approved (in 2015) component models. The user-defined models in system models can be problematic.</li>
<li>Current effective Reliability Standards MOD-026-1 and MOD-027-1 do not require a generator owner to provide verified models and data for IBR-specific controls to its transmission planner.</li>
<li>Current Reliability Standards neither require the transmission owner for unregistered IBRs to provide verified dynamic models nor require distribution providers to provide verified dynamic models of IBR-DERs.</li>
<li>Current effective Reliability Standards neither require IBR-DERs in the aggregate to submit the respective dynamic models to the applicable registered entities that perform planning and operations functions.</li>
<li>Current Reliability Standard MOD-033-2 requires validation using real-world data of the interconnection-wide model, the current effective Reliability Standards lack clarity as to whether models of registered IBRs, unregistered IBRs, and IBR-DERs in the aggregate are required to represent the real-world behavior of the equipment installed.</li>
<li>Current Reliability Standards do not require that any changes to IBR settings, configurations, and ratings are updated.</li>
<li>NERC annually assesses the interconnection-wide model quality and publishes a report to help entities responsible for complying with Reliability Standard MOD-032 to resolve model issues and improve the cases. NERC’s <a href="https://www.nerc.com/pa/RAPA/ModelAssessment/ModAssessments/2021_Case_Quality_Metrics_Assessment-FINAL.pdf">2021 Case Quality Metrics Assessment</a> indicates that planners are not able to develop accurate system models. All interconnections demonstrate either a consistent performance or a worsening score in the unacceptable or not recommended model metrics.</li>
<li>Reliability Standards MOD-032-1 and MOD-033-2 do not require the applicable entities to work collaboratively to create interconnection-wide models that accurately reflect the real-world interconnection-wide performance and behavior of registered and unregistered IBRs individually and in the aggregate, as well as IBR-DERs in aggregate.</li>
</ul></li>
<li>Performance Requirements
<ul>
<li>Current Reliability Standards do not account for the differences in the response of registered IBRs and synchronous generation resources during normal and contingency conditions.</li>
<li>Reliability Standard PRC-024-3 does not require registered IBRs (or any generator) to remain connected to the BPS and to continue to inject current and support frequency inside the “no trip zone.” Therefore, IBRs could continue to act adversely in response to normally cleared faults by continuing to exhibit momentary cessation and power reduction behaviors.</li>
<li>Current Reliability Standards do not require registered IBRs to continually inject current and support voltage inside the “no trip zone” during a voltage excursion. The Reliability Standards also do not contain voltage ride-through performance requirements that address the unique protection and control functions of registered IBRs that can cause tripping and momentary cessation, even when the IBR voltage protection settings comply with Reliability Standard PRC-024-3.</li>
<li>Current Reliability Standards do not require all generation resources that momentarily cease operation following a system disturbance to return to pre-disturbance output levels without impeded ramp rates or require that all generation resources maintain voltage phase angle synchronization with the BPS grid voltage during a system disturbance. Such momentary cessation occurrences exacerbate system disturbances and have a material impact on the reliable operation of the BPS.</li>
</ul></li>
</ul>
</section>
<section id="my-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="my-thoughts">My Thoughts</h2>
<p>After reading the Order, I feel that FERC is very anxious about IBR’s impact on North American BPS. FERC wants no more IBR tripping (momentary cessation). The try-and-error method of operating IBRs in the grid starts reaching its limit while the grid is retiring synchronous generators. I am well aware of IEEE-1547 and IBR control and stability analysis, however, I was shocked that in the past decade, our grid has been planned and operated without using IBR data and models. For a power electronics engineer, it’s like controlling your converter with a feedback loop’s PI parameters set by guessing. Now, we need to study the system carefully to derive our plant transfer function (model) validate it with measurement and design the system with a good amount of stability margin! However, the power system is more complicated than a single converter!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>